# hijack

## How to build
	1.1 sudo apt-get install libnetfilter-queue-dev

	1.2 cd hijack/server/src

	1.3 sh build.sh

## Notice

You have to adjust some IP addresses in the source code as follows: Change the IP address of the attacker's machine at line 242 in the file `hijack/client/index.html`.

The attack needs to know the exact size of the response to the request "http://www.cnn.com/SPECIALS/map.economy/images/jamie.smith.irpt.tn.jpg". However, the size varies on different machines due to HTTP headers embedded in the response. In the paper, we proposed a solution to automatically determine the size, yet I just manually set the correct value (retrieved from the developer tools in Chrome) to it by adding an option `-DSEQ_DELTA=1638` in the file `hijack/server/Makefile`. You can also use Wireshark to obtain such information.

During the attack's process, the TCP receive window size would grow as we keep requesting images. Based on the maximum window size that the client can achieve, you need to adjust the following at line 316 in the file `hijack/server/src/main.c`:
	`#define SEQ_WINDOW MAX_WINDOW_SIZE << 2`
where MAX_WINDOW_SIZE is the maximum window size representing the available space at the receiver's side.

## Set up environment
In order to set up the environment, we need one windows machine as the victim and one linux machine as the attacker. Our target website is `www.cnn.com`.

Network Topology:

	Attacker -------wire----------|
                                    Router ---------wireless-------Victim
	Server   -------wire----------|

On the attacker's machine, run the commands below:

	2.1 cd hijack/server

	2.2 sudo sh iptables.sh

	2.3 cd hijack/server/src

	2.4 sudo ./server

	2.5 cd hijack/client/src

	2.6 sudo python -m SimpleHTTPServer 80 (Alternatively, you can access to the malicious code (i.e., hijack/src/index.html) without setting up the HTTP server if you open the html file in browsers locally.)

## How to conduct experiment
	3.1 Launch Chrome and then access to the malicious website (http://attacker's IP address or file:///Path_to_the_dir/hijack/client/src/index.html)

	3.2 After the attack program finishes, you can access to the victim's website (i.e. www.cnn.com) to see whether the attack has successfully injected a page cached on the browser.
